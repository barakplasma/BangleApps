let hebrewCalendar = [
  {
    greg: 1640988000000,
    desc: "28 Tevet 5782",
    startEvent: 1640961929000,
    endEvent: 1641048371000,
  },
  {
    desc: "Havdalah",
    eventTime: "2022-01-01T15:26:00.000Z",
  },
  {
    greg: 1641074400000,
    desc: "29 Tevet 5782",
    startEvent: 1641048371000,
    endEvent: 1641134815000,
  },
  {
    greg: 1641160800000,
    desc: "1 Sh'vat 5782",
    startEvent: 1641134815000,
    endEvent: 1641221260000,
  },
  {
    greg: 1641160800000,
    desc: "Rosh Chodesh Sh'vat",
    startEvent: 1641134815000,
    endEvent: 1641221260000,
  },
  {
    greg: 1641247200000,
    desc: "2 Sh'vat 5782",
    startEvent: 1641221260000,
    endEvent: 1641307706000,
  },
  {
    greg: 1641333600000,
    desc: "3 Sh'vat 5782",
    startEvent: 1641307706000,
    endEvent: 1641394153000,
  },
  {
    greg: 1641420000000,
    desc: "4 Sh'vat 5782",
    startEvent: 1641394153000,
    endEvent: 1641480600000,
  },
  {
    greg: 1641506400000,
    desc: "5 Sh'vat 5782",
    startEvent: 1641480600000,
    endEvent: 1641567049000,
  },
  {
    desc: "Candle lighting",
    eventTime: "2022-01-07T14:32:00.000Z",
  },
  {
    greg: 1641592800000,
    desc: "6 Sh'vat 5782",
    startEvent: 1641567049000,
    endEvent: 1641653498000,
  },
  {
    desc: "Havdalah",
    eventTime: "2022-01-08T15:31:00.000Z",
  },
  {
    greg: 1641679200000,
    desc: "7 Sh'vat 5782",
    startEvent: 1641653498000,
    endEvent: 1641739948000,
  },
  {
    greg: 1641765600000,
    desc: "8 Sh'vat 5782",
    startEvent: 1641739948000,
    endEvent: 1641826398000,
  },
  {
    greg: 1641852000000,
    desc: "9 Sh'vat 5782",
    startEvent: 1641826398000,
    endEvent: 1641912849000,
  },
  {
    greg: 1641938400000,
    desc: "10 Sh'vat 5782",
    startEvent: 1641912849000,
    endEvent: 1641999301000,
  },
  {
    greg: 1642024800000,
    desc: "11 Sh'vat 5782",
    startEvent: 1641999301000,
    endEvent: 1642085753000,
  },
  {
    greg: 1642111200000,
    desc: "12 Sh'vat 5782",
    startEvent: 1642085753000,
    endEvent: 1642172206000,
  },
  {
    desc: "Candle lighting",
    eventTime: "2022-01-14T14:38:00.000Z",
  },
  {
    greg: 1642197600000,
    desc: "13 Sh'vat 5782",
    startEvent: 1642172206000,
    endEvent: 1642258659000,
  },
  {
    greg: 1642197600000,
    desc: "Shabbat Shirah",
    startEvent: 1642172206000,
    endEvent: 1642258659000,
  },
  {
    desc: "Havdalah",
    eventTime: "2022-01-15T15:37:00.000Z",
  },
  {
    greg: 1642284000000,
    desc: "14 Sh'vat 5782",
    startEvent: 1642258659000,
    endEvent: 1642345112000,
  },
  {
    greg: 1642370400000,
    desc: "15 Sh'vat 5782",
    startEvent: 1642345112000,
    endEvent: 1642431566000,
  },
  {
    greg: 1642370400000,
    desc: "Tu BiShvat",
    startEvent: 1642345112000,
    endEvent: 1642431566000,
  },
  {
    greg: 1642456800000,
    desc: "16 Sh'vat 5782",
    startEvent: 1642431566000,
    endEvent: 1642518021000,
  },
  {
    greg: 1642543200000,
    desc: "17 Sh'vat 5782",
    startEvent: 1642518021000,
    endEvent: 1642604475000,
  },
  {
    greg: 1642629600000,
    desc: "18 Sh'vat 5782",
    startEvent: 1642604475000,
    endEvent: 1642690930000,
  },
  {
    greg: 1642716000000,
    desc: "19 Sh'vat 5782",
    startEvent: 1642690930000,
    endEvent: 1642777385000,
  },
  {
    desc: "Candle lighting",
    eventTime: "2022-01-21T14:45:00.000Z",
  },
  {
    greg: 1642802400000,
    desc: "20 Sh'vat 5782",
    startEvent: 1642777385000,
    endEvent: 1642863840000,
  },
  {
    desc: "Havdalah",
    eventTime: "2022-01-22T15:42:00.000Z",
  },
  {
    greg: 1642888800000,
    desc: "21 Sh'vat 5782",
    startEvent: 1642863840000,
    endEvent: 1642950295000,
  },
  {
    greg: 1642975200000,
    desc: "22 Sh'vat 5782",
    startEvent: 1642950295000,
    endEvent: 1643036750000,
  },
  {
    greg: 1643061600000,
    desc: "23 Sh'vat 5782",
    startEvent: 1643036750000,
    endEvent: 1643123206000,
  },
  {
    greg: 1643148000000,
    desc: "24 Sh'vat 5782",
    startEvent: 1643123206000,
    endEvent: 1643209661000,
  },
  {
    greg: 1643234400000,
    desc: "25 Sh'vat 5782",
    startEvent: 1643209661000,
    endEvent: 1643296116000,
  },
  {
    greg: 1643320800000,
    desc: "26 Sh'vat 5782",
    startEvent: 1643296116000,
    endEvent: 1643382572000,
  },
  {
    desc: "Candle lighting",
    eventTime: "2022-01-28T14:51:00.000Z",
  },
  {
    greg: 1643407200000,
    desc: "27 Sh'vat 5782",
    startEvent: 1643382572000,
    endEvent: 1643469027000,
  },
  {
    desc: "Havdalah",
    eventTime: "2022-01-29T15:48:00.000Z",
  },
  {
    greg: 1643493600000,
    desc: "28 Sh'vat 5782",
    startEvent: 1643469027000,
    endEvent: 1643555482000,
  },
  {
    greg: 1643580000000,
    desc: "29 Sh'vat 5782",
    startEvent: 1643555482000,
    endEvent: 1643641937000,
  },
  {
    greg: 1643666400000,
    desc: "30 Sh'vat 5782",
    startEvent: 1643641937000,
    endEvent: 1643728392000,
  },
  {
    greg: 1643666400000,
    desc: "Rosh Chodesh Adar I",
    startEvent: 1643641937000,
    endEvent: 1643728392000,
  },
  {
    greg: 1643752800000,
    desc: "1 Adar I 5782",
    startEvent: 1643728392000,
    endEvent: 1643814846000,
  },
  {
    greg: 1643752800000,
    desc: "Rosh Chodesh Adar I",
    startEvent: 1643728392000,
    endEvent: 1643814846000,
  },
  {
    greg: 1643839200000,
    desc: "2 Adar I 5782",
    startEvent: 1643814846000,
    endEvent: 1643901301000,
  },
  {
    greg: 1643925600000,
    desc: "3 Adar I 5782",
    startEvent: 1643901301000,
    endEvent: 1643987755000,
  },
  {
    desc: "Candle lighting",
    eventTime: "2022-02-04T14:57:00.000Z",
  },
  {
    greg: 1644012000000,
    desc: "4 Adar I 5782",
    startEvent: 1643987755000,
    endEvent: 1644074209000,
  },
  {
    desc: "Havdalah",
    eventTime: "2022-02-05T15:54:00.000Z",
  },
  {
    greg: 1644098400000,
    desc: "5 Adar I 5782",
    startEvent: 1644074209000,
    endEvent: 1644160663000,
  },
  {
    greg: 1644184800000,
    desc: "6 Adar I 5782",
    startEvent: 1644160663000,
    endEvent: 1644247116000,
  },
  {
    greg: 1644271200000,
    desc: "7 Adar I 5782",
    startEvent: 1644247116000,
    endEvent: 1644333570000,
  },
  {
    greg: 1644357600000,
    desc: "8 Adar I 5782",
    startEvent: 1644333570000,
    endEvent: 1644420023000,
  },
  {
    greg: 1644444000000,
    desc: "9 Adar I 5782",
    startEvent: 1644420023000,
    endEvent: 1644506475000,
  },
  {
    greg: 1644530400000,
    desc: "10 Adar I 5782",
    startEvent: 1644506475000,
    endEvent: 1644592927000,
  },
  {
    desc: "Candle lighting",
    eventTime: "2022-02-11T15:04:00.000Z",
  },
  {
    greg: 1644616800000,
    desc: "11 Adar I 5782",
    startEvent: 1644592927000,
    endEvent: 1644679379000,
  },
  {
    desc: "Havdalah",
    eventTime: "2022-02-12T16:00:00.000Z",
  },
  {
    greg: 1644703200000,
    desc: "12 Adar I 5782",
    startEvent: 1644679379000,
    endEvent: 1644765831000,
  },
  {
    greg: 1644789600000,
    desc: "13 Adar I 5782",
    startEvent: 1644765831000,
    endEvent: 1644852282000,
  },
  {
    greg: 1644876000000,
    desc: "14 Adar I 5782",
    startEvent: 1644852282000,
    endEvent: 1644938733000,
  },
  {
    greg: 1644876000000,
    desc: "Purim Katan",
    startEvent: 1644852282000,
    endEvent: 1644938733000,
  },
  {
    greg: 1644962400000,
    desc: "15 Adar I 5782",
    startEvent: 1644938733000,
    endEvent: 1645025184000,
  },
  {
    greg: 1645048800000,
    desc: "16 Adar I 5782",
    startEvent: 1645025184000,
    endEvent: 1645111634000,
  },
  {
    greg: 1645135200000,
    desc: "17 Adar I 5782",
    startEvent: 1645111634000,
    endEvent: 1645198084000,
  },
  {
    desc: "Candle lighting",
    eventTime: "2022-02-18T15:10:00.000Z",
  },
  {
    greg: 1645221600000,
    desc: "18 Adar I 5782",
    startEvent: 1645198084000,
    endEvent: 1645284533000,
  },
  {
    desc: "Havdalah",
    eventTime: "2022-02-19T16:06:00.000Z",
  },
  {
    greg: 1645308000000,
    desc: "19 Adar I 5782",
    startEvent: 1645284533000,
    endEvent: 1645370982000,
  },
  {
    greg: 1645394400000,
    desc: "20 Adar I 5782",
    startEvent: 1645370982000,
    endEvent: 1645457431000,
  },
  {
    greg: 1645480800000,
    desc: "21 Adar I 5782",
    startEvent: 1645457431000,
    endEvent: 1645543879000,
  },
  {
    greg: 1645567200000,
    desc: "22 Adar I 5782",
    startEvent: 1645543879000,
    endEvent: 1645630327000,
  },
  {
    greg: 1645653600000,
    desc: "23 Adar I 5782",
    startEvent: 1645630327000,
    endEvent: 1645716774000,
  },
  {
    greg: 1645740000000,
    desc: "24 Adar I 5782",
    startEvent: 1645716774000,
    endEvent: 1645803222000,
  },
  {
    desc: "Candle lighting",
    eventTime: "2022-02-25T15:15:00.000Z",
  },
  {
    greg: 1645826400000,
    desc: "25 Adar I 5782",
    startEvent: 1645803222000,
    endEvent: 1645889668000,
  },
  {
    greg: 1645826400000,
    desc: "Shabbat Shekalim",
    startEvent: 1645803222000,
    endEvent: 1645889668000,
  },
  {
    desc: "Havdalah",
    eventTime: "2022-02-26T16:11:00.000Z",
  },
  {
    greg: 1645912800000,
    desc: "26 Adar I 5782",
    startEvent: 1645889668000,
    endEvent: 1645976115000,
  },
  {
    greg: 1645999200000,
    desc: "27 Adar I 5782",
    startEvent: 1645976115000,
    endEvent: 1646062561000,
  },
  {
    greg: 1646085600000,
    desc: "28 Adar I 5782",
    startEvent: 1646062561000,
    endEvent: 1646149007000,
  },
  {
    greg: 1646172000000,
    desc: "29 Adar I 5782",
    startEvent: 1646149007000,
    endEvent: 1646235452000,
  },
  {
    greg: 1646258400000,
    desc: "30 Adar I 5782",
    startEvent: 1646235452000,
    endEvent: 1646321897000,
  },
  {
    greg: 1646258400000,
    desc: "Rosh Chodesh Adar II",
    startEvent: 1646235452000,
    endEvent: 1646321897000,
  },
  {
    greg: 1646344800000,
    desc: "1 Adar II 5782",
    startEvent: 1646321897000,
    endEvent: 1646408342000,
  },
  {
    greg: 1646344800000,
    desc: "Rosh Chodesh Adar II",
    startEvent: 1646321897000,
    endEvent: 1646408342000,
  },
  {
    desc: "Candle lighting",
    eventTime: "2022-03-04T15:21:00.000Z",
  },
  {
    greg: 1646431200000,
    desc: "2 Adar II 5782",
    startEvent: 1646408342000,
    endEvent: 1646494787000,
  },
  {
    desc: "Havdalah",
    eventTime: "2022-03-05T16:16:00.000Z",
  },
  {
    greg: 1646517600000,
    desc: "3 Adar II 5782",
    startEvent: 1646494787000,
    endEvent: 1646581231000,
  },
  {
    greg: 1646604000000,
    desc: "4 Adar II 5782",
    startEvent: 1646581231000,
    endEvent: 1646667675000,
  },
  {
    greg: 1646690400000,
    desc: "5 Adar II 5782",
    startEvent: 1646667675000,
    endEvent: 1646754118000,
  },
  {
    greg: 1646776800000,
    desc: "6 Adar II 5782",
    startEvent: 1646754118000,
    endEvent: 1646840562000,
  },
  {
    greg: 1646863200000,
    desc: "7 Adar II 5782",
    startEvent: 1646840562000,
    endEvent: 1646927005000,
  },
  {
    greg: 1646949600000,
    desc: "8 Adar II 5782",
    startEvent: 1646927005000,
    endEvent: 1647013447000,
  },
  {
    desc: "Candle lighting",
    eventTime: "2022-03-11T15:26:00.000Z",
  },
  {
    greg: 1647036000000,
    desc: "9 Adar II 5782",
    startEvent: 1647013447000,
    endEvent: 1647099890000,
  },
];

const dayInMS = 86400000;

function flatten(arr, depth) {
  depth = depth ? depth : (depth = 1);
  return arr.reduce(
    (a, v) =>
      a.concat(depth > 1 && Array.isArray(v) ? flatten(v, depth - 1) : v),
    []
  );
}

g.clear(1);
Bangle.drawWidgets();

var Layout = require("Layout");
const Locale = require("locale");
var layout = function () {
  const now = Date.now();

  const current = hebrewCalendar.filter(
    (x) => x.startEvent < now && x.endEvent > now
  );

  const events = current.map((event) => {
    return {
      type: "txt",
      font: "6x8:2",
      label: event.desc,
      pad: 5,
      bgCol: g.theme.bg,
    };
  });

  const upcoming = flatten(
    hebrewCalendar
      .filter((x) => x.startEvent > now && x.startEvent < now + dayInMS)
      .slice(0, 3)
      .map((event) => {
        return [
          {
            type: "txt",
            font: "6x8:2",
            label: event.desc,
            pad: 5,
            bgCol: g.theme.bg,
          },
          {
            type: "txt",
            font: "6x8",
            label: `at ${Locale.time(new Date(event.startEvent))}`,
            pad: 5,
            bgCol: g.theme.bg,
          },
        ];
      })
  );

  return new Layout({
    type: "v",
    c: [
      {
        type: "txt",
        font: "6x8",
        label: "-- Hebrew Calendar Events --",
        pad: 2,
        bgCol: g.theme.bg2,
      },
      {
        type: "txt",
        font: "6x8",
        label: "Currently",
        pad: 2,
        bgCol: g.theme.bgH,
      },
    ]
      .concat(events)
      .concat([
        {
          type: "txt",
          font: "6x8",
          label: "Upcoming",
          pad: 2,
          bgCol: g.theme.bgH,
        },
      ])
      .concat(upcoming)
      .concat([
        {
          type: "txt",
          font: "6x8",
          label: "Gregorian",
          pad: 2,
          bgCol: g.theme.bg2,
        },
        {
          type: "txt",
          font: "6x8",
          label: Locale.date(new Date()) + " " + Locale.time(new Date(), 1),
          pad: 5,
          bgCol: undefined
        },
      ]),
  });
};
layout().render();

setInterval(function () {
  layout().render();
}, 1000 * 60);
